python - <<'PY2'
from pathlib import Path
import re,sys
viol=[]
for wf in Path('.github/workflows').glob('*.yml'):
 for i,l in enumerate(wf.read_text().splitlines(),1):
  m=re.search(r'uses:\s*([^@\s]+)@([^\s]+)',l)
  if not m: continue
  ref=m.group(2)
  if not re.fullmatch(r'[0-9a-f]{40}', ref):
   viol.append(f'{wf}:{i}:{ref}')
if viol:
 print('Unpinned actions:')
 print('\n'.join(viol))
 sys.exit(1)
print('all actions pinned')
PY2
