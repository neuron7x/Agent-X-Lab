run() { echo "+ $*"; "$@"; rc=$?; echo "EXIT_CODE=$rc"; return $rc; }

# Baseline
run git rev-parse HEAD
run git branch --show-current
run git status --porcelain
run git diff --name-only

# Verification
run python3 engine/scripts/check_prod_spec_gates.py --ac artifacts/AC_VERSION.json --pb-dir ad2026_state/pb/ --ssdf artifacts/SSDF.map --artifacts-dir artifacts/ --out build_proof/prod_spec/gate_check.report.json
run ls -la artifacts build_proof/prod_spec
run python3 -c 'import datetime, json, pathlib; payload={"schema":"REBUILD_LOG_V1","generated_at":datetime.datetime.now(datetime.timezone.utc).replace(microsecond=0).isoformat().replace("+00:00","Z"),"independent_build_count":2,"build_strategy":"ci_deterministic_probe","source":"local_prod_spec_fix"}; pathlib.Path("artifacts/rebuild.log").write_text(json.dumps(payload, indent=2)+"\n", encoding="utf-8"); pathlib.Path("build_proof/prod_spec/rebuild.log").write_text(json.dumps(payload, indent=2)+"\n", encoding="utf-8")'
run python3 -c 'import json; d=json.load(open("artifacts/ARB.decision.memo", encoding="utf-8")); print(json.dumps({"decision":d.get("decision"),"approved":d.get("approval",{}).get("approved"),"approved_at":d.get("approval",{}).get("approved_at"),"author":d.get("author"),"approver":d.get("approver"),"auditor":d.get("auditor")}, indent=2))'
