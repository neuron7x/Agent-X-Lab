# INVARIANT_MAP

## Determinism hazards

| file:line | hazard | minimal fix | proof |
|---|---|---|---|
| engine/exoneural_governor/util.py:16 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/objects/dse-fix-opt/eval/run_harness.py:37 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/objects/dse-fix-opt/eval/run_harness.py:148 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/objects/pr-orchestrator/eval/run_harness.py:37 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/objects/pr-orchestrator/eval/run_harness.py:148 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/scripts/check_prod_spec_gates.py:739 | fs_write (open(w)) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/scripts/check_prod_spec_gates.py:532 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/scripts/check_prod_spec_gates.py:61 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/scripts/check_prod_spec_gates.py:66 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/scripts/rebuild_catalog_index.py:25 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/conftest.py:40 | env_mutation (os.environ[...]=) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/conftest.py:62 | env_mutation (os.environ[...]=) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_isolation_fixture.py:24 | env_mutation (os.environ[...]=) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_isolation_fixture.py:44 | env_mutation (os.environ[...]=) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_isolation_fixture.py:45 | env_mutation (os.environ[...]=) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_isolation_fixture.py:46 | env_mutation (os.environ[...]=) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_readme_contract.py:20 | fs_write (shutil.copytree) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_rebuild_catalog_index.py:30 | fs_write (shutil.copytree) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tests/test_stack.py:33 | fs_write (shutil.copytree) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tools/agent/run_and_log.py:97 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tools/feg_r8_verify.py:16 | nondet_time (time.time) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tools/feg_r8_verify.py:24 | nondet_time (time.time) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tools/nongit_runner.py:24 | fs_write (shutil.copytree) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tools/pip_audit_gate.py:156 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/tools/run_gate.py:16 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/vendor/scpe-cimqa-2026.3.0/tools/deadlock_fingerprint.py:66 | fs_write (os.makedirs) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/vendor/scpe-cimqa-2026.3.0/tools/observe_meta_state.py:112 | fs_write (os.makedirs) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/vendor/scpe-cimqa-2026.3.0/tools/prove_meta_validity.py:97 | fs_write (os.makedirs) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| engine/vendor/scpe-cimqa-2026.3.0/tools/validate_erm_ast.py:51 | fs_write (os.makedirs) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_artifacts_2026-02-26/engine/scripts/check_prod_spec_gates.py:728 | fs_write (open(w)) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_artifacts_2026-02-26/engine/scripts/check_prod_spec_gates.py:532 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_artifacts_2026-02-26/engine/scripts/check_prod_spec_gates.py:61 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_artifacts_2026-02-26/engine/scripts/check_prod_spec_gates.py:66 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_bundle_2026-02-26/engine/scripts/check_prod_spec_gates.py:728 | fs_write (open(w)) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_bundle_2026-02-26/engine/scripts/check_prod_spec_gates.py:532 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_bundle_2026-02-26/engine/scripts/check_prod_spec_gates.py:61 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| evidence/release_wrapper/promoted_bundle_2026-02-26/engine/scripts/check_prod_spec_gates.py:66 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| sources/legacy/E-legacy_snapshot/engine.py:293 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| sources/legacy/E-legacy_snapshot/evidence.py:193 | fs_write (open(a)) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |
| sources/legacy/E-legacy_snapshot/evidence.py:188 | nondet_datetime (datetime.now) | inject deterministic source / constrain side effects | (cmd: "python - <<PY (repo_profile, dag, blockers, determinism, invariants, entropy)") -> (file: outputs/determinism_findings.json) -> (metric/output-hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) |

## Invariant table

| ID | Invariant | Evidence (cmd + hash) | Enforced at | Violations (file:line) | Minimal enforcement | Impact |
|---|---|---|---|---|---|---|
| INV-001 | All workflow action refs must be SHA-pinned or local/docker | (cmd: "python tools/verify_action_pinning.py --workflows .github/workflows") -> (hash: babd2d70bb9bd8c5ee7991f7e08ae0720c5f9791ef4a28042af6f1f75490a78c) | .github/workflows/* | none | keep verifier in CI | 95 |
| INV-002 | All workflows must declare permissions | (cmd: "python tools/verify_workflow_hygiene.py --workflows .github/workflows") -> (hash: a735a840cca039ec8e46dffaeefce5217665d76d8b50fd01e653ed91ba29fc2f) | .github/workflows/* | none | keep hygiene gate required | 85 |
| INV-003 | All workflows must declare concurrency | (cmd: "python tools/verify_workflow_hygiene.py --workflows .github/workflows") -> (hash: a735a840cca039ec8e46dffaeefce5217665d76d8b50fd01e653ed91ba29fc2f) | .github/workflows/* | none | keep hygiene gate required | 80 |
| INV-004 | All jobs must set timeout-minutes | (cmd: "python tools/verify_workflow_hygiene.py --workflows .github/workflows") -> (hash: a735a840cca039ec8e46dffaeefce5217665d76d8b50fd01e653ed91ba29fc2f) | .github/workflows/* | none | keep hygiene gate required | 80 |
| INV-005 | No runner context outside run blocks | (cmd: "python - <<PY (workflow blocker scan)") -> (hash: 241a3d3c12e9a753520153678fb1a269b266d0e230050899758b559bc297c59a) | .github/workflows/* | none | refactor context usage into run/env blocks | 78 |
| INV-006 | Local actions need non-empty name | (cmd: "python - <<PY (workflow blocker scan)") -> (hash: 241a3d3c12e9a753520153678fb1a269b266d0e230050899758b559bc297c59a) | .github/actions/**/action.yml | none | validate action.yml metadata in pre-commit | 60 |
| INV-007 | Local actions need non-empty description | (cmd: "python - <<PY (workflow blocker scan)") -> (hash: 241a3d3c12e9a753520153678fb1a269b266d0e230050899758b559bc297c59a) | .github/actions/**/action.yml | .github/actions/pin-pip/action.yml:1 | add description field | 75 |
| INV-008 | Avoid SC2129 repeated append in same run block | (cmd: "python - <<PY (workflow blocker scan)") -> (hash: 241a3d3c12e9a753520153678fb1a269b266d0e230050899758b559bc297c59a) | .github/workflows/* | .github/workflows/engine-drift-guard.yml:89-97; .github/workflows/python-verify.yml:34-46 | group redirects with { ...; } >> file | 70 |
| INV-009 | Pytest suite must pass deterministically in envelope | (cmd: "python -m pytest -q --durations=20") -> (hash: 7f217d7dbbb6c83dffabe20080f61dc7b0b2efdd6ad5a91779d7fe3647faf94a) | engine/tests,udgs_core/tests | none | pin deterministic env in test workflows | 92 |
| INV-010 | Dependency DAG must be reproducibly generated | (cmd: "python - <<PY (repo_profile, dag, ...)") -> (hash: 1dfd296c6aefb8a46aa23741d17fc79025fe0d52aa53d173ec8953af2062582b) | ARCH_DAG.json | none | keep stdlib DAG builder script | 66 |
| INV-011 | Determinism hazard scan must enumerate nondeterministic calls | (cmd: "python - <<PY (repo_profile, dag, ...)") -> (hash: f46090be8948d3583a57e0f06ce1bae67c03468744616486bbf7cb08675ad183) | engine/**,udgs_core/**,tools/** | 88 findings | prioritize high-risk hazards in P0 | 88 |
| INV-012 | Entropy hotspot report must include top complexity functions | (cmd: "python - <<PY (repo_profile, dag, ...)") -> (hash: 518573f75be7ab86e833d98f496c51859524c4958c15e5ab30116f9b8dbb12dc) | outputs/entropy_metrics.json | none | set complexity budget guard | 72 |
| INV-013 | Policy pinning tool should exist and run | (cmd: "test -f tools/verify_action_pinning.py") -> (hash: babd2d70bb9bd8c5ee7991f7e08ae0720c5f9791ef4a28042af6f1f75490a78c) | tools/verify_action_pinning.py | none | prevent deletion via CI check | 77 |
| INV-014 | Policy hygiene tool should exist and run | (cmd: "test -f tools/verify_workflow_hygiene.py") -> (hash: a735a840cca039ec8e46dffaeefce5217665d76d8b50fd01e653ed91ba29fc2f) | tools/verify_workflow_hygiene.py | none | prevent deletion via CI check | 77 |
| INV-015 | Secrets scan must run offline every cycle | (cmd: "python - <<PY (secrets grep fallback)") -> (hash: 494de0f74025af32f291cf6edf57c0ad9fa41e8ff991c309dba9d14f78e24750) | repository text files | 5 findings | triage and suppress only with expiring allowlist | 90 |
| INV-016 | Memory mode decision must be evidence-backed | (cmd: "python - <<PY (memory/tensor trigger scan)") -> (hash: 544c5c08a97fd8291c636b527dbb3d4cbe62557d39035c8a441662b49d743584) | outputs/memory_mode.txt | none | keep marker scan list versioned | 40 |
| INV-017 | Tensor mode decision must be evidence-backed | (cmd: "python - <<PY (memory/tensor trigger scan)") -> (hash: 52398ece2be9478ac89af803816640033b52b0d5f5502408a5884072cdd09403) | outputs/tensor_kernel_mode.txt | none | keep marker scan list versioned | 45 |
| INV-018 | Repo profile generation must be stdlib deterministic | (cmd: "python - <<PY (repo_profile, dag, ...)") -> (hash: da27e1ffa2dce742785d1b8b249bf14e6ae098d7bf5b1ec18e6d777a0508eea8) | repo_profile.json | none | freeze ignore patterns | 65 |
| INV-019 | Command provenance log must include executed commands | (cmd: "cat commands.txt") -> (hash: 9ed4b3d1106683901b63c0c5833ea58ffa2d631919539e90b473f65359e1f0a4) | commands.txt | none | automate log wrapper function | 74 |
| INV-020 | Evidence integrity requires sha256 manifest | (cmd: "sha256sum over evidence dir") -> (hash: 6548f8a168c809ba53c952d896527dabf139fbc6cabac8384696e2ec11c3efb6) | sha256sum.txt | none | verify manifest in CI | 90 |
| INV-021 | ARCH_DAG.dot should be generated for graph tooling | (cmd: "python - <<PY (repo_profile, dag, ...)") -> (hash: 6fc6fd9e7e6b9afddde6dcd07350aa729568aca806630e59d7d46882552880ec) | ARCH_DAG.dot | none | validate DOT parse in CI | 50 |
| INV-022 | Security tools availability must be recorded, not assumed | (cmd: "command -v bandit/ruff") -> (hash: 5d84cc1d487c24f3deb6e71451572fb898afbfdf99a275d3da2e07e85a4f256f) | outputs/security/* | none | introduce internal fallback checks | 55 |
