{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "axl://schemas/aaid/v2.1",
  "title": "AAIDAttestation",
  "description": "Hardware-bound identity attestation â€” G6-AUTH-HW gate. Required for PROD_SPEC (not restricted_sandbox only).",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "aaid",
    "env_class",
    "pubkey",
    "key_metadata",
    "tee_quote",
    "issued_at",
    "expires_at",
    "registry_ref"
  ],
  "properties": {
    "aaid": {
      "type": "string",
      "pattern": "^AAID-[A-F0-9]{16,}$",
      "description": "Hardware-bound agent identity â€” short-lived, non-transferable"
    },
    "env_class": {
      "type": "string",
      "enum": ["tee_enabled"],
      "description": "AAID.attestation is only valid for tee_enabled â€” restricted_sandbox skips this gate"
    },
    "pubkey": {
      "type": "object",
      "required": ["kty", "crv", "x", "y", "use", "kid"],
      "description": "JWK public key bound to TEE measurement"
    },
    "key_metadata": {
      "type": "object",
      "required": ["purpose", "ttl_seconds", "rotation_policy"],
      "additionalProperties": false,
      "properties": {
        "purpose":         { "type": "string", "enum": ["signing", "attestation"] },
        "ttl_seconds":     { "type": "integer", "minimum": 1, "maximum": 86400,
                             "description": "Max 24h; rotation enforced before expiry" },
        "rotation_policy": { "type": "string", "enum": ["auto", "manual_with_alert"] }
      }
    },
    "tee_quote": {
      "type": "object",
      "required": ["type", "report_data", "mr_enclave", "mr_signer", "quote_body"],
      "additionalProperties": false,
      "properties": {
        "type":        { "type": "string", "enum": ["SGX_DCAP", "TDX", "SEV_SNP", "TPM2"] },
        "report_data": { "type": "string", "pattern": "^[a-f0-9]{64,128}$",
                         "description": "SHA-256/512 of public key bound in this quote" },
        "mr_enclave":  { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "mr_signer":   { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "quote_body":  { "type": "string", "description": "Base64url-encoded raw quote body" }
      }
    },
    "issued_at":    { "type": "string", "format": "date-time" },
    "expires_at":   { "type": "string", "format": "date-time",
                      "description": "Must be > issued_at and < issued_at + ttl_seconds" },
    "registry_ref": { "type": "string", "description": "URI in AAID registry for chain verification" }
  }
}
